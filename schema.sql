alter session set "_ORACLE_SCRIPT"=true;
CREATE USER HCMUS IDENTIFIED BY HCMUS;
GRANT DBA, RESOURCE TO HCMUS WITH ADMIN OPTION;
GRANT CREATE SESSION TO HCMUS;
GRANT ALL PRIVILEGES TO HCMUS;
GRANT EXEMPT ACCESS POLICY TO HCMUS;


/* tạo bảng nhân viên*/
CREATE TABLE NHANVIEN 
(
  MANV VARCHAR2(5)
, HOTEN VARCHAR2(50) 
, DIACHI VARCHAR2(50) 
, DIENTHOAI VARCHAR2(50) 
, EMAIL VARCHAR2(50) 
, MAPHONG VARCHAR2(5)
, CHINHANH VARCHAR2(5)
, LUONG NUMBER
, CHUCVU NUMBER 
, CONSTRAINT NHANVIEN_PK PRIMARY KEY(MANV)
);
/* tạo bảng phong ban*/
CREATE TABLE PHONGBAN 
(
  MAPHONG VARCHAR2(5)
, TENPHONG VARCHAR2(50) 
, TRUONGPHONG VARCHAR2(5) 
, NGAYNHANCHUC DATE 
, SONHANVIEN NUMBER 
, CHINHANH VARCHAR2(5) 
, CONSTRAINT PHONGBAN_PK PRIMARY KEY(MAPHONG)
);

/* tạo bảng chi nhánh */
CREATE TABLE CHINHANH(
  MACN VARCHAR2(5)
, TENCN VARCHAR2(50)
, TRUONGCHINHANH VARCHAR2(5)
, CONSTRAINT CHINHANH_PK PRIMARY KEY(MACN)
);

/* tạo bảng dự án*/
CREATE TABLE DUAN 
(
  MADA VARCHAR2(5)
, TENDA VARCHAR2(50)
, KINHPHI NUMBER
, PHONGCHUTRI VARCHAR2(5)
, TRUONGDA VARCHAR2(5)
, CONSTRAINT DUAN_PK PRIMARY KEY(MADA) 
);

/* tạo bảng phân công*/
CREATE TABLE PHANCONG 
(
  MANV VARCHAR2(5)
, DUAN VARCHAR2(5)
, VAITRO VARCHAR2(50) 
, PHUCAP NUMBER 
, CONSTRAINT PHANCONG_PK PRIMARY KEY(MANV,DUAN)
);

/* tạo bảng chi tiêu*/
CREATE TABLE CHITIEU 
(
  MACHITIEU VARCHAR2(5) 
, TENCHITIEU VARCHAR2(50)
, SOTIEN NUMBER
, DUAN VARCHAR2(5) 
, CONSTRAINT CHITIEU_PK PRIMARY KEY(MACHITIEU)
);

/* khóa ngoại*/
ALTER TABLE CHINHANH ADD CONSTRAINT FK_CHINHANH_NHANVIEN FOREIGN KEY (TRUONGCHINHANH) REFERENCES NHANVIEN(MANV);
ALTER TABLE CHITIEU ADD CONSTRAINT FK_CHITIEU_DUAN FOREIGN KEY (DUAN) REFERENCES DUAN(MADA);
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_CHINHANH FOREIGN KEY (CHINHANH) REFERENCES CHINHANH(MACN);
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_PHONGBAN FOREIGN KEY (MAPHONG) REFERENCES PHONGBAN(MAPHONG);
ALTER TABLE PHANCONG ADD CONSTRAINT FK_PHANCONG_NHANVIEN FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV);
ALTER TABLE PHANCONG ADD CONSTRAINT FK_PHANCONG_DUAN FOREIGN KEY (DUAN) REFERENCES DUAN(MADA);
ALTER TABLE PHONGBAN ADD CONSTRAINT FK_PHONGBAN_CHINHANH FOREIGN KEY (CHINHANH) REFERENCES CHINHANH(MACN);
ALTER TABLE DUAN ADD CONSTRAINT FK_DUAN_PHONGBAN FOREIGN KEY (PHONGCHUTRI) REFERENCES PHONGBAN(MAPHONG);
ALTER TABLE DUAN ADD CONSTRAINT FK_DUAN_NHANVIEN FOREIGN KEY (TRUONGDA) REFERENCES NHANVIEN(MANV);

alter session set "_ORACLE_SCRIPT"=true;
-- LOGIN AS HCMUS
/*INSERT DATA CHI NHÁNH*/
insert into CHINHANH(MACN,TENCN,TRUONGCHINHANH)VALUES ('CN001','Tổng Công Ty',null);
insert into CHINHANH(MACN,TENCN,TRUONGCHINHANH)VALUES ('CN002','TP. Hồ Chí Minh',null);
insert into CHINHANH(MACN,TENCN,TRUONGCHINHANH)VALUES ('CN003','Hà Nội',null);
insert into CHINHANH(MACN,TENCN,TRUONGCHINHANH)VALUES ('CN004','Đà Nẵng',null);
insert into CHINHANH(MACN,TENCN,TRUONGCHINHANH)VALUES ('CN005','Hải Dương',null);
/*INSERT DATA PHÒNG BAN*/
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB001','Nhân Sự',null,TO_DATE('25/04/2017','DD/MM/YYYY'),10,'CN001');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB002','Kế Toán',null,TO_DATE('25/03/2017','DD/MM/YYYY'),10,'CN001');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB003','Kế Hoạch',null,TO_DATE('20/04/2017','DD/MM/YYYY'),10,'CN001');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB004','Kinh Doanh',null,TO_DATE('5/04/2017','DD/MM/YYYY'),10,'CN001');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB005','Kỹ Thuật',null,TO_DATE('2/04/2017','DD/MM/YYYY'),10,'CN001');

insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB006','Nhân Sự',null,TO_DATE('25/04/2017','DD/MM/YYYY'),10,'CN002');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB007','Kế Toán',null,TO_DATE('25/03/2017','DD/MM/YYYY'),10,'CN002');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB008','Kế Hoạch',null,TO_DATE('20/04/2017','DD/MM/YYYY'),10,'CN002');

insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB009','Nhân Sự',null,TO_DATE('25/04/2017','DD/MM/YYYY'),10,'CN003');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB010','Kế Toán',null,TO_DATE('25/03/2017','DD/MM/YYYY'),10,'CN003');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB011','Kế Hoạch',null,TO_DATE('20/04/2017','DD/MM/YYYY'),10,'CN003');

insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB012','Nhân Sự',null,TO_DATE('25/04/2017','DD/MM/YYYY'),10,'CN004');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB013','Kế Toán',null,TO_DATE('25/03/2017','DD/MM/YYYY'),10,'CN004');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB014','Kế Hoạch',null,TO_DATE('20/04/2017','DD/MM/YYYY'),10,'CN004');

insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB015','Nhân Sự',null,TO_DATE('25/04/2017','DD/MM/YYYY'),10,'CN005');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB016','Kế Toán',null,TO_DATE('25/03/2017','DD/MM/YYYY'),10,'CN005');
insert into PHONGBAN(MAPHONG,TENPHONG,TRUONGPHONG,NGAYNHANCHUC,SONHANVIEN,CHINHANH)VALUES ('PB017','Kế Hoạch',null,TO_DATE('20/04/2017','DD/MM/YYYY'),10,'CN005');
/*INSERT DATA NHÂN VIÊN*/
-- CHI NHÁNH TỔNG
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV001','Binsu','Hồ Chí Minh','123456789','NV001.lab01@gmail.com','PB001','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV002','Bánh Tráng Trộn','Hồ Chí Minh','1123456789','NV002.lab01@gmail.com','PB001','CN001',550,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV003','Susi Hàn Quốc','Hồ Chí Minh','1223456789','NV003.lab01@gmail.com','PB001','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV004','Cánh Gà Chiên Mắm','Hà Nội','1233456789','NV004.lab01@gmail.com','PB001','CN001',600,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV005','Hột Vịt Lộn','Hà Nội','1234456789','NV005.lab01@gmail.com','PB001','CN001',600,0);
                                                                          
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV006','Nguyễn Văn C','Hà Nội','1234556789','NV006.lab01@gmail.com','PB002','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV007','Cao Mông D','Đà Nẵng','1234566789','NV007.lab01@gmail.com','PB002','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV008','Si Mộng','Hồ Chí Minh','123456789','NV008.lab01@gmail.com','PB002','CN001',500,1);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV009','Mộng Si','Hồ Chí Minh','1234567897','NV009.lab01@gmail.com','PB002','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV010','Lùn Thế Kỷ','Hồ Chí Minh','1234556789','NV010.lab01@gmail.com','PB002','CN001',500,0);
                                                                         
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV011','Dương Quá','Hồ Chí Minh','1234567894','NV011.lab01@gmail.com','PB003','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV012','Cô Long','Huế','1234567897','NV12.lab001@gmail.com','PB003','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV013','Quách Tĩnh','Quãng Nam','1234556789','NV013.lab01@gmail.com','PB003','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV014','Hoàng Dung','Quãng Ngãi','1234567894','NV014.lab01@gmail.com','PB003','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV015','Lý Mạc Sầu','Hồ Chí Minh','1234556789','NV015.lab01@gmail.com','PB003','CN001',500,0);
                                                                         
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV016','Trần Trường Sinh','Hồ Chí Minh','1234567894','NV016.lab01@gmail.com','PB004','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV017','Lặc Lạc','Huế','1234567897','NV017.lab01@gmail.com','PB004','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV018','Từ Hữu Dung','Quãng Nam','1234556789','NV018.lab01@gmail.com','PB004','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV019','Tam Thập Lục','Quãng Ngãi','1234567894','NV019.lab01@gmail.com','PB004','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV020','Trang Hoán Vũ','Quãng Ngãi','1234567894','NV020.lab01@gmail.com','PB004','CN001',500,0);
                                                                       
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV021','Nguyễn Cao A','Hồ Chí Minh','1234567894','NV021.lab01@gmail.com','PB005','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV022','Dương Thế B','Huế','1234567897','NV022.lab01@gmail.com','PB005','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV023','Cao Bùi C','Quãng Nam','1234556789','NV023.lab01@gmail.com','PB005','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV024','Dương Mịch','Quãng Ngãi','1234567894','NV024.lab01@gmail.com','PB005','CN001',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV025','Cao Thâm','Quãng Ngãi','1234567894','NV025.lab01@gmail.com','PB005','CN001',500,1);

-- CHI NHÁNH HỒ CHÍ MINH
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV026','Binsu','Hồ Chí Minh','123456789','NV001.lab01@gmail.com','PB006','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV027','Bánh Tráng Trộn','Hồ Chí Minh','1123456789','NV002.lab01@gmail.com','PB006','CN002',550,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV028','Susi Hàn Quốc','Hồ Chí Minh','1223456789','NV003.lab01@gmail.com','PB006','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV029','Cánh Gà Chiên Mắm','Hà Nội','1233456789','NV004.lab01@gmail.com','PB006','CN002',600,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV030','Hột Vịt Lộn','Hà Nội','1234456789','NV005.lab01@gmail.com','PB006','CN002',600,0);
  
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV031','Nguyễn Văn C','Hà Nội','1234556789','NV006.lab01@gmail.com','PB007','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV032','Cao Mông D','Đà Nẵng','1234566789','NV007.lab01@gmail.com','PB007','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV033','Si Mộng','Hồ Chí Minh','123456789','NV008.lab01@gmail.com','PB007','CN002',500,1);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV034','Mộng Si','Hồ Chí Minh','1234567897','NV009.lab01@gmail.com','PB007','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV035','Lùn Thế Kỷ','Hồ Chí Minh','1234556789','NV010.lab01@gmail.com','PB007','CN002',500,0);
                                                                         
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV036','Dương Quá','Hồ Chí Minh','1234567894','NV011.lab01@gmail.com','PB008','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV037','Cô Long','Huế','1234567897','NV12.lab001@gmail.com','PB008','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV038','Quách Tĩnh','Quãng Nam','1234556789','NV013.lab01@gmail.com','PB008','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV039','Hoàng Dung','Quãng Ngãi','1234567894','NV014.lab01@gmail.com','PB008','CN002',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV040','Lý Mạc Sầu','Hồ Chí Minh','1234556789','NV015.lab01@gmail.com','PB008','CN002',500,0);

-- CHI NHÁNH HÀ NỘI
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV041','Binsu','Hồ Chí Minh','123456789','NV001.lab01@gmail.com','PB009','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV042','Bánh Tráng Trộn','Hồ Chí Minh','1123456789','NV002.lab01@gmail.com','PB009','CN003',550,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV043','Susi Hàn Quốc','Hồ Chí Minh','1223456789','NV003.lab01@gmail.com','PB009','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV044','Cánh Gà Chiên Mắm','Hà Nội','1233456789','NV004.lab01@gmail.com','PB009','CN003',600,1);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV045','Hột Vịt Lộn','Hà Nội','1234456789','NV005.lab01@gmail.com','PB009','CN003',600,0);
  
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV046','Nguyễn Văn C','Hà Nội','1234556789','NV006.lab01@gmail.com','PB010','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV047','Cao Mông D','Đà Nẵng','1234566789','NV007.lab01@gmail.com','PB010','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV048','Si Mộng','Hồ Chí Minh','123456789','NV008.lab01@gmail.com','PB010','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV049','Mộng Si','Hồ Chí Minh','1234567897','NV009.lab01@gmail.com','PB010','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV050','Lùn Thế Kỷ','Hồ Chí Minh','1234556789','NV010.lab01@gmail.com','PB010','CN003',500,0);
                                                                         
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV051','Dương Quá','Hồ Chí Minh','1234567894','NV011.lab01@gmail.com','PB011','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV052','Cô Long','Huế','1234567897','NV12.lab001@gmail.com','PB011','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV053','Quách Tĩnh','Quãng Nam','1234556789','NV013.lab01@gmail.com','PB011','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV054','Hoàng Dung','Quãng Ngãi','1234567894','NV014.lab01@gmail.com','PB011','CN003',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV055','Lý Mạc Sầu','Hồ Chí Minh','1234556789','NV015.lab01@gmail.com','PB011','CN003',500,0);


-- CHI NHÁNH ĐÀ NẴNG
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV056','Binsu','Hồ Chí Minh','123456789','NV001.lab01@gmail.com','PB012','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV057','Bánh Tráng Trộn','Hồ Chí Minh','1123456789','NV002.lab01@gmail.com','PB012','CN004',550,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV058','Susi Hàn Quốc','Hồ Chí Minh','1223456789','NV003.lab01@gmail.com','PB012','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV059','Cánh Gà Chiên Mắm','Hà Nội','1233456789','NV004.lab01@gmail.com','PB012','CN004',600,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV060','Hột Vịt Lộn','Hà Nội','1234456789','NV005.lab01@gmail.com','PB012','CN004',600,0);
  
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV061','Nguyễn Văn C','Hà Nội','1234556789','NV006.lab01@gmail.com','PB013','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV062','Cao Mông D','Đà Nẵng','1234566789','NV007.lab01@gmail.com','PB013','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV063','Si Mộng','Hồ Chí Minh','123456789','NV008.lab01@gmail.com','PB013','CN004',500,4);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV064','Mộng Si','Hồ Chí Minh','1234567897','NV009.lab01@gmail.com','PB013','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV065','Lùn Thế Kỷ','Hồ Chí Minh','1234556789','NV010.lab01@gmail.com','PB013','CN004',500,0);
                                                                         
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV066','Dương Quá','Hồ Chí Minh','1234567894','NV011.lab01@gmail.com','PB014','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV067','Cô Long','Huế','1234567897','NV12.lab001@gmail.com','PB014','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV068','Quách Tĩnh','Quãng Nam','1234556789','NV013.lab01@gmail.com','PB014','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV069','Hoàng Dung','Quãng Ngãi','1234567894','NV014.lab01@gmail.com','PB014','CN004',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV070','Lý Mạc Sầu','Hồ Chí Minh','1234556789','NV015.lab01@gmail.com','PB014','CN004',500,0);

-- CHI NHÁNH HẢI DƯƠNG
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV071','Binsu','Hồ Chí Minh','123456789','NV001.lab01@gmail.com','PB015','CN005',500,0);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV072','Bánh Tráng Trộn','Hồ Chí Minh','1123456789','NV002.lab01@gmail.com','PB016','CN005',550,5);
insert into NHANVIEN (MANV,HOTEN,DIACHI,DIENTHOAI,EMAIL,MAPHONG,CHINHANH,LUONG,CHUCVU)VALUES ('NV073','Susi Hàn Quốc','Hồ Chí Minh','1223456789','NV003.lab01@gmail.com','PB017','CN005',500,0);
  

/*DATA DỰ ÁN*/
-- CÁC DỰ ÁN THUỘC TỔNG CÔNG TY
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA001','Bất động sản',1000000,'PB001','NV003');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA002','Xây Dựng',1000000,'PB001','NV003');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA003','Công nghệ sinh',2000000,'PB001','NV008');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA004','Dạy Học',2000000,'PB002','NV008');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA005','Trí tuệ',3000000,'PB002','NV008');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA006','Tự Động Hóa',3000000,'PB003','NV013');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA007','Autobot',4000000,'PB003','NV013');
-- CÁC DỰ ÁN THUỘC HỒ CHÍ MINH
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA008','Bán Xe Máy',4000000,'PB006','NV027');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA009','Vật liệu rắn',5000000,'PB007','NV032');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA010','Thoát Nước',5000000,'PB008','NV037');
-- CÁC DỰ ÁN THUỘC HÀ NỘI
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA011','Vật liệu rắn',50000,'PB009','NV043');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA012','Thoát Nước',50000,'PB010','NV048');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA013','Vật liệu rắn',50000,'PB011','NV052');
-- CÁC DỰ ÁN THUỘC ĐÃ NẴNG
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA014','Thoát Nước',50000,'PB012','NV058');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA015','Tự Động Hóa',3000000,'PB013','NV058');
insert into DUAN(MADA,TENDA,KINHPHI,PHONGCHUTRI,TRUONGDA)VALUES ('DA016','Autobot',4000000,'PB014','NV058');
/*data phân công*/

insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV004','DA001','Thành viên',20);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV004','DA002','Giám sát',30);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV009','DA003','Quản lý',40);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV009','DA004','Thành viên',20);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV014','DA005','Giám sát',30);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV014','DA006','Quản lý',40);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV019','DA007','Quản lý',40);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV019','DA008','Thành viên',20);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV024','DA009','Giám sát',30);
insert into PHANCONG (MANV,DUAN,VAITRO,PHUCAP)VALUES ('NV024','DA010','Quản lý',40);

/*data chi tiêu*/
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT001','Phí di chuyển',100,'DA001');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT002','Phí ăn uống',200,'DA001');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT003','Phí vật liệu',300,'DA001');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT004','Phí di chuyển',100,'DA002');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT005','Phí ăn uống',200,'DA002');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT006','Phí vật liệu',300,'DA002');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT007','Phí di chuyển',100,'DA003');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT008','Phí ăn uống',200,'DA003');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT009','Phí vật liệu',300,'DA003');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT010','Phí di chuyển',100,'DA004');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT011','Phí ăn uống',200,'DA004');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT012','Phí vật liệu',300,'DA004');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT013','Phí di chuyển',100,'DA005');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT014','Phí ăn uống',200,'DA005');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT015','Phí vật liệu',300,'DA005');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT016','Phí ăn uống',200,'DA006');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT017','Phí vật liệu',300,'DA006');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT018','Phí ăn uống',200,'DA006');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT019','Phí vật liệu',300,'DA007');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT020','Phí ăn uống',200,'DA007');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT021','Phí vật liệu',300,'DA007');

insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT022','Phí vật liệu',300,'DA008');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT023','Phí ăn uống',200,'DA009');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT024','Phí vật liệu',300,'DA010');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT025','Phí ăn uống',200,'DA011');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT026','Phí vật liệu',300,'DA012');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT027','Phí ăn uống',200,'DA013');
insert into CHITIEU(MACHITIEU,TENCHITIEU,SOTIEN,DUAN)VALUES ('CT028','Phí vật liệu',300,'DA014');


update PHONGBAN set TRUONGPHONG='NV002' where MAPHONG='PB001';
update PHONGBAN set TRUONGPHONG='NV007' where MAPHONG='PB002';
update PHONGBAN set TRUONGPHONG='NV012' where MAPHONG='PB003';
update PHONGBAN set TRUONGPHONG='NV017' where MAPHONG='PB004';
update PHONGBAN set TRUONGPHONG='NV022' where MAPHONG='PB005';

update PHONGBAN set TRUONGPHONG='NV027' where MAPHONG='PB006';
update PHONGBAN set TRUONGPHONG='NV031' where MAPHONG='PB007';
update PHONGBAN set TRUONGPHONG='NV036' where MAPHONG='PB008';

update PHONGBAN set TRUONGPHONG='NV042' where MAPHONG='PB009';
update PHONGBAN set TRUONGPHONG='NV046' where MAPHONG='PB010';
update PHONGBAN set TRUONGPHONG='NV050' where MAPHONG='PB011';

update PHONGBAN set TRUONGPHONG='NV056' where MAPHONG='PB012';
update PHONGBAN set TRUONGPHONG='NV060' where MAPHONG='PB013';
update PHONGBAN set TRUONGPHONG='NV064' where MAPHONG='PB014';

update PHONGBAN set TRUONGPHONG='NV073' where MAPHONG='PB015';
update PHONGBAN set TRUONGPHONG='NV073' where MAPHONG='PB016';
update PHONGBAN set TRUONGPHONG='NV073' where MAPHONG='PB017';

update CHINHANH set TRUONGCHINHANH='NV001' where MACN='CN001';
update CHINHANH set TRUONGCHINHANH='NV026' where MACN='CN002';
update CHINHANH set TRUONGCHINHANH='NV041' where MACN='CN003';
update CHINHANH set TRUONGCHINHANH='NV056' where MACN='CN004';
update CHINHANH set TRUONGCHINHANH='NV071' where MACN='CN005';

--Tạo user từ mã nhân viên
declare
  TEMP varchar2(200);
begin
for MANV in (select MANV from NHANVIEN)
loop
  TEMP := 'create user ' || MANV.MANV || ' identified by ' || MANV.MANV || ' default tablespace users temporary tablespace temp';
  execute immediate TEMP;
end loop;
end;     

-- Cấp quyền đăng nhập và tọa session
declare
  TEMP varchar2(500);
begin
for USERNAME in (select MANV from NHANVIEN)
loop
  TEMP := 'grant create session to ' || USERNAME.MANV;
  execute immediate TEMP;
end loop;
end;


-- LOGIN AS HCMUS, chạy các lệnh bên dưới để tạo role--
create role R_GIAMDOC;
create role R_TRUONGPHONG;
create role R_TRUONGCHINHANH;
create role R_TRUONGDUAN;
create role R_NHANVIEN;

-- CÁC HÀM PHỤC VỤ CÀI ĐẶT CHÍNH SÁCH VPD
--tạo package SET_NHANVIEN_CTX_PKG
create or replace package SET_NHANVIEN_CTX_PKG
as
    procedure SET_PHONGBAN;
    procedure CHECK_TRUONGPHONG;
    procedure CHECK_TRUONGCHINHANH;
    procedure CHECK_TRUONGDUAN;
	procedure CHECK_GIAMDOC;
end;

--tạo context NHANVIEN_CTX
CREATE OR REPLACE CONTEXT NHANVIEN_CTX USING SET_NHANVIEN_CTX_PKG;
-- nội dung pkg

create or replace package body SET_NHANVIEN_CTX_PKG
as
  procedure SET_PHONGBAN
  as PHONGBAN varchar2(5);
  begin
    select MAPHONG into PHONGBAN from HCMUS.NHANVIEN where MANV = sys_context('userenv', 'session_user');
    dbms_session.set_context('NHANVIEN_CTX', 'PHONGBAN', PHONGBAN);
  end;
  
  procedure CHECK_TRUONGPHONG
  as ISTRUONGPB varchar2(5);
  begin
    select case 
        when exists(select MAPHONG  from HCMUS.PHONGBAN where TRUONGPHONG = sys_context('userenv', 'session_user'))
        then 'TRUE'
        else 'FALSE'
      end into ISTRUONGPB
    from dual;
    dbms_session.set_context('NHANVIEN_CTX', 'ISTRUONGPB', ISTRUONGPB);
  end;
  
  procedure CHECK_TRUONGCHINHANH
  as ISTRUONGCN varchar2(5);
  begin
    select case 
        when exists(select MACN  from HCMUS.CHINHANH where TRUONGCHINHANH = sys_context('userenv', 'session_user'))
        then 'TRUE'
        else 'FALSE'
      end into ISTRUONGCN
    from dual;
    dbms_session.set_context('NHANVIEN_CTX', 'ISTRUONGCN', ISTRUONGCN);
  end;
  
  procedure CHECK_TRUONGDUAN
  as ISTRUONGDA varchar2(5);
  begin
    select case 
        when exists(select MADA  from HCMUS.DUAN where TRUONGDA = sys_context('userenv', 'session_user'))
        then 'TRUE'
        else 'FALSE'
      end into ISTRUONGDA
    from dual;
    dbms_session.set_context('NHANVIEN_CTX', 'ISTRUONGDA', ISTRUONGDA);
  end;
  
  procedure CHECK_GIAMDOC
  as ISGIAMDOC varchar2(5);
  begin
    select case 
        when exists(select MANV  from HCMUS.NHANVIEN where CHUCVU = 1)
        then 'TRUE'
        else 'FALSE'
      end into ISGIAMDOC
    from dual;
    dbms_session.set_context('NHANVIEN_CTX', 'ISGIAMDOC', ISGIAMDOC);
  end;
end;

--tạo logon trigger cho package
create or replace trigger set_NHANVIEN_CTX_TRIGGER after logon on database
begin
    HCMUS.SET_NHANVIEN_CTX_PKG.SET_PHONGBAN;
    HCMUS.SET_NHANVIEN_CTX_PKG.CHECK_TRUONGPHONG;
    HCMUS.SET_NHANVIEN_CTX_PKG.CHECK_TRUONGCHINHANH;
    HCMUS.SET_NHANVIEN_CTX_PKG.CHECK_TRUONGDUAN;
	HCMUS.SET_NHANVIEN_CTX_PKG.CHECK_GIAMDOC;
end;